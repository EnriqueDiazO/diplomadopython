% =========================================================
%  Preamble común — paquetes y configuración compartida
%  (Úsalo desde libros y plantillas Cornell)
% =========================================================

% ------------------------------
% Codificación, tipografías, idioma
% ------------------------------
\usepackage[utf8]{inputenc}   % Entrada en UTF-8 (acentos directos)
\usepackage[T1]{fontenc}      % Codificación de salida T1 (mejor separación silábica)
\usepackage{lmodern}          % Familia Latin Modern (mejor que Computer Modern)
\usepackage[spanish,es-lcroman,es-tabla]{babel}
\usepackage[toc,page,titletoc]{appendix}
\addto\captionsspanish{%
\renewcommand{\contentsname}{Contenido}
\renewcommand\bibname{Referencias}
\renewcommand{\chaptername}{} %Para quitar de los encabezados la palabra "capítulo"
\renewcommand{\listfigurename}{Lista de Figuras}
\renewcommand{\listtablename}{Lista de Tablas}
\renewcommand{\tablename}{Tabla}
\renewcommand\appendixname{Anexos}
\renewcommand\appendixpagename{Anexos}
\renewcommand{\appendixtocname}{Anexos}
}

% ------------------------------
% Maquetación y gráficos
% ------------------------------
\usepackage{geometry}         % Márgenes y tamaño de página
\geometry{margin=2.5cm}       % Margen por defecto del monorepo
\usepackage{graphicx}         % Inserción de figuras/imágenes
\usepackage{xcolor}           % Colores (para hipervínculos, cajas, etc.)


\usepackage[T1]{fontenc}
\usepackage{titlesec, blindtext, color}
\definecolor{gray75}{gray}{0.75}
\newcommand{\hsp}{\hspace{20pt}}
\titleformat{\chapter}[hang]{\large\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\large\bfseries\raggedright}
\titlespacing{\chapter}{0pt}{0pt}{10pt}[0pt]
\titleformat*{\section}{\normalsize\bfseries\raggedright}
\titlespacing*{\section}{0pt}{10pt}{0pt}[0pt]
\titleformat*{\subsection}{\normalsize\bfseries\raggedright}
\titlespacing*{\subsection}{0pt}{10pt}{0pt}[0pt]
\titleformat*{\subsubsection}{\normalsize\bfseries\raggedright}
\titlespacing*{\subsubsection}{0pt}{10pt}{0pt}[0pt]

\usepackage{fancyhdr}
\usepackage{fancyref}
\usepackage{etoolbox}


\fancypagestyle{fi-page}{
  \fancyhf{}  % limpia encabezado y pie
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}

  % Eliminar contenido del encabezado generado automáticamente
  \renewcommand{\chaptermark}[1]{}  % anula \leftmark
  \renewcommand{\sectionmark}[1]{}  % anula \rightmark

  \newcommand{\changefont}{\fontsize{9}{11}\selectfont}

  \fancyfoot[C]{\changefont \thepage} % solo número de página centrado
}



% ------------------------------
% Hipervínculos
% ------------------------------
\usepackage{hyperref}         % Enlaces internos/externos
\hypersetup{
    colorlinks=true,
    linkcolor=blue,           % Color de enlaces internos (TOC, refs)
    urlcolor=blue,            % Color de URLs
    citecolor=blue            % Color de citas (biblatex)
}

% ------------------------------
% Estructura de párrafos y matemáticas
% ------------------------------
\usepackage{parskip}          % Párrafos sin sangría + espacio vertical
\usepackage{amsmath, amssymb} % Entornos y símbolos matemáticos

% ------------------------------
% URLs largas y microtipografía (mejora de corte de línea)
% ------------------------------
\usepackage{xurl}                 % Permite cortes de línea dentro de \url
\PassOptionsToPackage{hyphens}{url}{} % Mejora cortes con hyperref/url
\urlstyle{same}                   % Misma fuente para \url que el texto
\usepackage{microtype}            % Ajustes sutiles de espaciado (mejor legibilidad)
\emergencystretch=3em             % (Opcional) Relaja el corte de línea en párrafos problemáticos

% ------------------------------
% Bibliografía con biblatex/biber
% ------------------------------
\usepackage{csquotes} % Recomendado por biblatex (gestión de comillas)
\usepackage[backend=biber,style=authoryear,sorting=nyt]{biblatex}

% Carga ADAPTABLE del .bib según el modo de compilación:
% - Cuando compilas con latexmk usando aux/out en latex.out (build del monorepo)
% - Cuando compilas "in-place" (make refs) dejando main.pdf junto al .tex
% - Como último recurso, cuando compilas desde la raíz del repo
\makeatletter
\IfFileExists{../../../../common/bibliography.bib}{%
  % Caso 1: compilación con latex.out (el .aux vive en .../book/latex.out/)
  \addbibresource{../../../../common/bibliography.bib}%
}{%
  \IfFileExists{../../../common/bibliography.bib}{%
    % Caso 2: compilación in-place (el .aux vive en .../book/)
    \addbibresource{../../../common/bibliography.bib}%
  }{%
    \IfFileExists{common/bibliography.bib}{%
      % Caso 3: compilación desde la raíz del repositorio
      \addbibresource{common/bibliography.bib}%
    }{%
      % Aviso para depuración si no se encuentra el .bib
      \typeout{[WARN] bibliography.bib no encontrado en rutas conocidas.}%
    }%
  }%
}
\makeatother

% Definir colores parar el código
% --------------------------------------------
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\definecolor{titlepagecolor}{cmyk}{1,.60,0,.40}
\definecolor{namecolor}{cmyk}{1,.50,0,.10} 

\usepackage{listings}
\usepackage{listingsutf8}
\renewcommand{\lstlistingname}{Scripts}% Listing -> Algorithm
\renewcommand{\lstlistlistingname}{Lista de \lstlistingname }% List of Listings -> List of Algorithms

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    inputencoding=utf8
}

\lstset{style=mystyle,
literate=%
{á}{{\'a}}{1}%
{é}{{\'e}}{1}%
{í}{{\'i}}{1}%
{ó}{{\'o}}{1}%
{ú}{{\'u}}{1}%
{Á}{{\'A}}{1}%
{É}{{\'E}}{1}%
{Í}{{\'I}}{1}%
{Ó}{{\'O}}{1}%
{Ú}{{\'U}}{1}%
{ñ}{{\~n}}1%
{Ñ}{{\~N}}1%
{ü}{{\"u}}1%
{Ü}{{\"U}}1%
{¿}{{\textquestiondown}}1 
{¡}{{\textexclamdown}}1
}
% Rutas de figuras de este módulo

\usepackage{coloredtheorem}
% --- cajas con tcolorbox a través de coloredtheorem ---
%   (colores: azul para definiciones, rojo para teoremas,
%    verde para corolarios, púrpura para lemas… cambia al gusto)
%
\cthnewtheorem{definicion}{Definición}[colback=blue!5,colframe=blue!75!black,coltitle=white!85!black,fonttitle=\bfseries]

\cthnewtheorem{teorema}{Teorema}[colback=red!5,colframe=red!65!black,coltitle=white!80!black,fonttitle=\bfseries]

\cthnewtheorem{corolario}{Corolario}[colback=green!5,colframe=green!60!black,coltitle=white!70!black,fonttitle=\bfseries]

\cthnewtheorem{lema}{Lema}[colback=purple!5,colframe=purple!60!black,coltitle=white!75!black,fonttitle=\bfseries]

\cthnewtheorem{proposicion}{Proposición}[colback=orange!5,colframe=white!70!black,coltitle=orange!85!black,fonttitle=\bfseries]

\cthnewtheorem{ejemplo}{Ejemplo}[colback=gray!8,colframe=gray!60,coltitle=white!20!black,fonttitle=\bfseries]

\cthnewtheorem{nota}{Nota}[colback=yellow!10,colframe=yellow!65!black,coltitle=white!80!black,fonttitle=\bfseries]

\cthnewtheorem{observacion}{Observación}[colback=teal!6,colframe=teal!60!black,coltitle=white!75!black,fonttitle=\bfseries]

% --------------------------------------------
% Alias “legacy” (por compatibilidad con ntheorem)
% --------------------------------------------
\let\theorem     \cthteorema
\let\endtheorem  \endcthteorema
\let\definition  \cthdefinicion
\let\enddefinition\endcthdefinicion
\let\corollary   \cthcorolario
\let\endcorollary\endcthcorolario
\let\lemma       \cthlema
\let\endlemma    \endcthlema
\let\proposition \cthproposicion
\let\endproposition\endcthproposicion
\let\example     \cthejemplo
\let\endexample  \endcthejemplo
\let\remark      \cthnota
\let\endremark   \endcthnota